<script>
document.addEventListener('DOMContentLoaded', function() {
  // Mobile menu functionality
  const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
  const mobileMenu = document.getElementById('mobile-menu');
  
  if (mobileMenuToggle && mobileMenu) {
    const hamburger = mobileMenuToggle.querySelector('.hamburger');
    
    function closeMobileMenu() {
      mobileMenu.classList.remove('open');
      hamburger?.classList.remove('open');
      mobileMenuToggle.setAttribute('aria-expanded', 'false');
    }
    
    mobileMenuToggle.addEventListener('click', function() {
      const isOpen = mobileMenu.classList.toggle('open');
      hamburger?.classList.toggle('open');
      mobileMenuToggle.setAttribute('aria-expanded', isOpen);
    });
    
    mobileMenu.querySelectorAll('.nav-link').forEach(link => {
      link.addEventListener('click', closeMobileMenu);
    });
    
    document.addEventListener('click', function(e) {
      if (!mobileMenuToggle.contains(e.target) && !mobileMenu.contains(e.target)) {
        closeMobileMenu();
      }
    });
  }
  
  // Enhanced header scroll effect for liquid glass
  const header = document.getElementById('site-header');
  if (header) {
    let ticking = false;
    let lastScrollY = 0;
    
    function updateHeader() {
      const scrollY = window.scrollY;
      const scrollProgress = Math.min(scrollY / 200, 1); // Normalize to 0-1 over 200px
      
      // Add/remove scrolled class
      header.classList.toggle('scrolled', scrollY > 50);
      
      // Enhanced blur effect based on scroll speed and position
      const scrollSpeed = Math.abs(scrollY - lastScrollY);
      const dynamicBlur = 25 + (scrollProgress * 10) + (scrollSpeed * 0.5);
      const dynamicSaturation = 1.8 + (scrollProgress * 0.4);
      
      // Apply dynamic backdrop filter for enhanced liquid glass effect
      const backdropFilter = `blur(${Math.min(dynamicBlur, 40)}px) saturate(${dynamicSaturation})`;
      header.style.backdropFilter = backdropFilter;
      header.style.webkitBackdropFilter = backdropFilter;
      
      lastScrollY = scrollY;
      ticking = false;
    }
    
    window.addEventListener('scroll', function() {
      if (!ticking) {
        requestAnimationFrame(updateHeader);
        ticking = true;
      }
    }, { passive: true });
  }
  
  // Intersection Observer for animations - optimized
  if ('IntersectionObserver' in window) {
    const animatedElements = document.querySelectorAll('.service-card, .hero-feature, .glass-card');
    if (animatedElements.length > 0) {
      const observer = new IntersectionObserver(entries => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('animate-in');
            observer.unobserve(entry.target);
          }
        });
      }, { threshold: 0.1, rootMargin: '0px 0px -50px 0px' });
      
      animatedElements.forEach(el => {
        el.classList.add('animate-ready');
        observer.observe(el);
      });
    }
  }
});
</script>

<!-- Liquid Glass Effect - Performance Optimized -->
<script async src="{{ "/assets/js/liquid-glass.js" | relative_url }}"></script>